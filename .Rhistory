library(readxl)
library(ggrepel)
library(cluster)
# Chunk 2
#| message: false
#| warning: false
# read nouns
arch_nouns <- read_xlsx("data/COW16 nouns cleaned.xlsx")
# read adj
arch_adj   <- read_xlsx("data/COW16 adjectives cleaned.xlsx")
# Chunk 3
#| message: false
#| warning: false
# remove false hits
arch_adj <- filter(arch_adj, Keep=="y")
arch_nouns <- filter(arch_nouns, Keep=="y")
# get bases
arch_adj$Base_Lemma <- gsub("^arch-?", "", arch_adj$Token)
arch_nouns$Base_Lemma <- gsub("^arch-?", "", arch_nouns$Token)
# make sheet for annotating lexemes / correcting lemmas
# rbind(mutate(arch_adj, pos = "ADJ"), mutate(arch_nouns, pos = "N")) %>% writexl::write_xlsx("arch_adj_n.xlsx")
# read in again
arch <- read_xlsx("data/arch_adj_n.xlsx")
# Chunk 4
#| message: false
#| warning: false
#| include: false
model <- readRDS("/Users/stefanhartmann/sciebo/Projekte/snowclones/word2vec/model.Rds")
# Chunk 6
#| message: false
#| warning: false
# get lemmas
lemmas <- sort(unique(arch$Base_Lemma))
# get Cosine distance
cosDist_mds <- cosineDist(model[[tolower(lemmas), average = FALSE]], model[[tolower(lemmas), average = FALSE]]) %>% cmdscale()
# get k-means clusters
plot(1:10, sapply(1:10, function(x) kmeans(cosDist_mds, x, nstart = 25)$tot.withinss), type = "b", ylab = "WCSS")
k_means_clusters <- kmeans(cosDist_mds, 3, nstart = 25)
# as df
cosDist_mds <- cosDist_mds %>% as.data.frame() %>% rownames_to_column()
colnames(cosDist_mds)[1] <- "lemma"
# add frequency information
freqs <- rbind(arch_adj, arch_nouns) %>% select(Base_Lemma, Frequency) %>%
group_by(Base_Lemma) %>%
summarise(
n = sum(Frequency)
) %>% setNames(c("lemma", "n"))
# multidimensional scaling
cosDist_mds <- left_join(cosDist_mds, freqs) %>% replace_na(list(n = 0))
# also add log frequency
cosDist_mds$logFreq <- log1p(cosDist_mds$n)
# add k-means clusters to df
cosDist_mds$kcluster <- as.factor(as.numeric(k_means_clusters$cluster))
# Chunk 7
#| message: false
#| warning: false
set.seed(1705)
cosDist_mds %>% filter(logFreq>2) %>% ggplot(aes(x = V1, y = V2,
size = n*5, label = lemma)) +
stat_ellipse(aes(group = as.factor(kcluster), fill = as.factor(kcluster)),
geom = "polygon", alpha = 0.1, color = NA) +
geom_text_repel(max.overlaps = 25) + theme_bw() + guides(size = 'none') +
guides(col = "none", fill = "none") +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
# ggsave("images/archdistances_k_means.png", width = 7, height = 5, dpi = 600)
# Chunk 1
#| message: false
#| warning: false
#| code-fold: true
library(tidyverse)
library(wordVectors)
library(vroom)
library(pbapply)
library(readxl)
library(ggrepel)
library(cluster)
# Chunk 2
#| message: false
#| warning: false
# read nouns
arch_nouns <- read_xlsx("data/COW16 nouns cleaned.xlsx")
# read adj
arch_adj   <- read_xlsx("data/COW16 adjectives cleaned.xlsx")
# Chunk 3
#| message: false
#| warning: false
# remove false hits
arch_adj <- filter(arch_adj, Keep=="y")
arch_nouns <- filter(arch_nouns, Keep=="y")
# get bases
arch_adj$Base_Lemma <- gsub("^arch-?", "", arch_adj$Token)
arch_nouns$Base_Lemma <- gsub("^arch-?", "", arch_nouns$Token)
# make sheet for annotating lexemes / correcting lemmas
# rbind(mutate(arch_adj, pos = "ADJ"), mutate(arch_nouns, pos = "N")) %>% writexl::write_xlsx("arch_adj_n.xlsx")
# read in again
arch <- read_xlsx("data/arch_adj_n.xlsx")
# Chunk 4
#| message: false
#| warning: false
#| include: false
model <- readRDS("/Users/stefanhartmann/sciebo/Projekte/snowclones/word2vec/model.Rds")
# Chunk 6
#| message: false
#| warning: false
# get lemmas
lemmas <- sort(unique(arch$Base_Lemma))
# get Cosine distance
cosDist_mds <- cosineDist(model[[tolower(lemmas), average = FALSE]], model[[tolower(lemmas), average = FALSE]]) %>% cmdscale()
# get k-means clusters
plot(1:10, sapply(1:10, function(x) kmeans(cosDist_mds, x, nstart = 25)$tot.withinss), type = "b", ylab = "WCSS")
k_means_clusters <- kmeans(cosDist_mds, 3, nstart = 25)
# as df
cosDist_mds <- cosDist_mds %>% as.data.frame() %>% rownames_to_column()
colnames(cosDist_mds)[1] <- "lemma"
# add frequency information
freqs <- rbind(arch_adj, arch_nouns) %>% select(Base_Lemma, Frequency) %>%
group_by(Base_Lemma) %>%
summarise(
n = sum(Frequency)
) %>% setNames(c("lemma", "n"))
# multidimensional scaling
cosDist_mds <- left_join(cosDist_mds, freqs) %>% replace_na(list(n = 0))
# also add log frequency
cosDist_mds$logFreq <- log1p(cosDist_mds$n)
# add k-means clusters to df
cosDist_mds$kcluster <- as.factor(as.numeric(k_means_clusters$cluster))
# Chunk 7
#| message: false
#| warning: false
set.seed(1705)
cosDist_mds %>% filter(logFreq>1.5) %>% ggplot(aes(x = V1, y = V2,
size = n*5, label = lemma)) +
stat_ellipse(aes(group = as.factor(kcluster), fill = as.factor(kcluster)),
geom = "polygon", alpha = 0.1, color = NA) +
geom_text_repel(max.overlaps = 25) + theme_bw() + guides(size = 'none') +
guides(col = "none", fill = "none") +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
# ggsave("images/archdistances_k_means.png", width = 7, height = 5, dpi = 600)
ggsave("images/archdistances_k_means.png", width = 7, height = 5, dpi = 600)
#| message: false
#| warning: false
set.seed(1705)
#| message: false
#| warning: false
set.seed(1705)
cosDist_mds %>% filter(n>5) %>% ggplot(aes(x = V1, y = V2,
size = n*5, label = lemma)) +
stat_ellipse(aes(group = as.factor(kcluster), fill = as.factor(kcluster)),
geom = "polygon", alpha = 0.1, color = NA) +
geom_text_repel(max.overlaps = 25) + theme_bw() + guides(size = 'none') +
guides(col = "none", fill = "none") +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
#| message: false
#| warning: false
set.seed(1705)
#| message: false
#| warning: false
set.seed(1705)
cosDist_mds %>% filter(n>4) %>% ggplot(aes(x = V1, y = V2,
size = n*5, label = lemma)) +
stat_ellipse(aes(group = as.factor(kcluster), fill = as.factor(kcluster)),
geom = "polygon", alpha = 0.1, color = NA) +
geom_text_repel(max.overlaps = 25) + theme_bw() + guides(size = 'none') +
guides(col = "none", fill = "none") +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
#| message: false
#| warning: false
set.seed(1705)
#| message: false
#| warning: false
set.seed(1705)
cosDist_mds %>% filter(n>2) %>% ggplot(aes(x = V1, y = V2,
size = n*5, label = lemma)) +
stat_ellipse(aes(group = as.factor(kcluster), fill = as.factor(kcluster)),
geom = "polygon", alpha = 0.1, color = NA) +
geom_text_repel(max.overlaps = 25) + theme_bw() + guides(size = 'none') +
guides(col = "none", fill = "none") +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
#| message: false
#| warning: false
set.seed(1705)
cosDist_mds %>%
# filter(n>2) %>%
ggplot(aes(x = V1, y = V2,
size = n*5, label = lemma)) +
stat_ellipse(aes(group = as.factor(kcluster), fill = as.factor(kcluster)),
geom = "polygon", alpha = 0.1, color = NA) +
geom_text_repel(max.overlaps = 25) + theme_bw() + guides(size = 'none') +
guides(col = "none", fill = "none") +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
ggsave("images/archdistances_k_means.png", width = 7, height = 5, dpi = 600)
#| message: false
#| warning: false
set.seed(1705)
#| message: false
#| warning: false
set.seed(1705)
cosDist_mds %>%
filter(n>4) %>%
ggplot(aes(x = V1, y = V2,
size = n*5, label = lemma)) +
stat_ellipse(aes(group = as.factor(kcluster), fill = as.factor(kcluster)),
geom = "polygon", alpha = 0.1, color = NA) +
geom_text_repel(max.overlaps = 25) + theme_bw() + guides(size = 'none') +
guides(col = "none", fill = "none") +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
ggsave("images/archdistances_k_means.png", width = 7, height = 5, dpi = 600)
library(ggiraph)
#| message: false
#| warning: false
#| fig-width: 20
#| fig-height: 20
set.seed(1705)
p <- cosDist_mds %>%
# filter(n>4) %>%
ggplot(aes(x = V1, y = V2,
size = n*5, label = lemma)) +
stat_ellipse(aes(group = as.factor(kcluster), fill = as.factor(kcluster)),
geom = "polygon", alpha = 0.1, color = NA) +
geom_text_repel(max.overlaps = 25) + theme_bw() + guides(size = 'none') +
guides(col = "none", fill = "none") +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
#| message: false
#| warning: false
#| fig-width: 20
#| fig-height: 20
set.seed(1705)
p <- cosDist_mds %>%
# filter(n>4) %>%
ggplot(aes(x = V1, y = V2,
size = n*5, label = lemma)) +
stat_ellipse(aes(group = as.factor(kcluster), fill = as.factor(kcluster)),
geom = "polygon", alpha = 0.1, color = NA) +
geom_text_repel(max.overlaps = 25) + theme_bw() + guides(size = 'none') +
guides(col = "none", fill = "none") +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
g <- girafe(ggobj = p,
options = list(
opts_zoom(max = 5),   # Allow zooming up to 5x
opts_sizing(rescale = TRUE),
opts_toolbar(saveaspng = TRUE)
))
g
?girafe
?opts_toolbar
set.seed(1705)
set.seed(1705)
cosDist_mds %>%
filter(n>4) %>%
ggplot(aes(x = V1, y = V2,
size = n*5, label = lemma)) +
stat_ellipse(aes(group = as.factor(kcluster), fill = as.factor(kcluster)),
geom = "polygon", alpha = 0.1, color = NA) +
geom_text() + theme_bw() + guides(size = 'none') +
guides(col = "none", fill = "none") +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
ggsave("images/archdistances_k_means.png", width = 7, height = 5, dpi = 600)
set.seed(1705)
cosDist_mds %>%
filter(n>4) %>%
ggplot(aes(x = V1, y = V2,
size = n*5, label = lemma)) +
stat_ellipse(aes(group = as.factor(kcluster), fill = as.factor(kcluster)),
geom = "polygon", alpha = 0.1, color = NA) +
geom_text_repel(max.overlaps = 35) + theme_bw() + guides(size = 'none') +
guides(col = "none", fill = "none") +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
ggsave("images/archdistances_k_means.png", width = 7, height = 5, dpi = 600)
cosDist_mds %>%
filter(n>4) %>%
ggplot(aes(x = V1, y = V2,
size = n*5, label = lemma)) +
stat_ellipse(aes(group = as.factor(kcluster), fill = as.factor(kcluster)),
geom = "polygon", alpha = 0.1, color = NA) +
geom_text_repel(max.overlaps = 35, seed = 1705) + theme_bw() + guides(size = 'none') +
guides(col = "none", fill = "none") +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
cosDist_mds %>%
filter(n>4) %>%
ggplot(aes(x = V1, y = V2,
size = n*5, label = lemma)) +
stat_ellipse(aes(group = as.factor(kcluster), fill = as.factor(kcluster)),
geom = "polygon", alpha = 0.1, color = NA) +
geom_text_repel(max.overlaps = 35, seed = 1705, segments(lwd = .2)) + theme_bw() + guides(size = 'none') +
guides(col = "none", fill = "none") +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
cosDist_mds %>%
filter(n>4) %>%
ggplot(aes(x = V1, y = V2,
size = n*5, label = lemma)) +
stat_ellipse(aes(group = as.factor(kcluster), fill = as.factor(kcluster)),
geom = "polygon", alpha = 0.1, color = NA) +
geom_text_repel(max.overlaps = 35, seed = 1705, segment.size = .2) + theme_bw() + guides(size = 'none') +
guides(col = "none", fill = "none") +
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())
ggsave("images/archdistances_k_means.png", width = 7, height = 5, dpi = 600)
devtools::install_github("hartmast/wizard")
devtools::install_github("hartmast/concordances")
#| message: false
#| warning: false
#| code-fold: true
library(tidyverse)
library(wordVectors)
devtools::install_github("bmschmidt/wordVectors")
library(tidyverse)
library(wordVectors)
library(vroom)
library(pbapply)
library(readxl)
library(ggrepel)
library(cluster)
#con <-url("https://osf.io/download/wxe2r/")
# model <- readRDS(con)
model <- readRDS("/Users/stefanhartmann/sciebo/Projekte/snowclones/word2vec/model.Rds")
con <-url("https://osf.io/download/wxe2r/")
model <- readRDS(con)
# con <-url("https://osf.io/download/wxe2r/")
# model <- readRDS(con)
model <- readRDS("/Users/stefanhartmann/sciebo/Projekte/snowclones/word2vec/model.Rds")
# check results
model %>% closest_to("fish")
model %>% closest_to("woman")
# cosine distances
# Inspect the similarity of several academic disciplines by hand.
subjects = model[[c("history","literature","biology","math","stats"),average=FALSE]]
similarities = cosineSimilarity(subjects,subjects)
similarities
# read nouns
arch_nouns <- read_xlsx("COW16 nouns cleaned.xlsx")
# read nouns
arch_nouns <- read_xlsx("data/COW16 nouns cleaned.xlsx")
# read adj
arch_adj   <- read_xlsx("data/COW16 adjectives cleaned.xlsx")
# remove false hits
arch_adj <- filter(arch_adj, Keep=="y")
arch_nouns <- filter(arch_nouns, Keep=="y")
# get bases
arch_adj$Base_Lemma <- gsub("^arch-?", "", arch_adj$Token)
arch_nouns$Base_Lemma <- gsub("^arch-?", "", arch_nouns$Token)
# read in again
arch <- read_xlsx("data/arch_adj_n.xlsx")
# get lemmas
lemmas <- sort(unique(arch$Base_Lemma))
# get Cosine distance
cosDist_mds <- cosineDist(model[[tolower(lemmas), average = FALSE]], model[[tolower(lemmas), average = FALSE]]) %>% cmdscale()
# get k-means clusters
plot(1:10, sapply(1:10, function(x) kmeans(cosDist_mds, x, nstart = 25)$tot.withinss), type = "b", ylab = "WCSS")
k_means_clusters <- kmeans(cosDist_mds, 3, nstart = 25)
# as df
cosDist_mds <- cosDist_mds %>% as.data.frame() %>% rownames_to_column()
colnames(cosDist_mds)[1] <- "lemma"
# add frequency information
freqs <- rbind(arch_adj, arch_nouns) %>% select(Base_Lemma, Frequency) %>%
group_by(Base_Lemma) %>%
summarise(
n = sum(Frequency)
) %>% setNames(c("lemma", "n"))
# freqs <- c(arch_adj$Base_Lemma, arch_nouns$Base_Lemma) %>% table %>% sort %>% as_tibble() %>% setNames(c("lemma", "n"))
cosDist_mds <- left_join(cosDist_mds, freqs) %>% replace_na(list(n = 0))
cosDist_mds$logFreq <- log1p(cosDist_mds$n)
# get PAM clusters
pams <- c()
for(i in 1:15) {
cur_pam <- pam(cosDist_mds, k = i)
pams[i] <- cur_pam$silinfo$avg.width
}
plot(1:15, pams, type = "b") # line elbows at ~ 3
pam_clusters <- pam(cosDist_mds, k = 3)
cosDist_mds$clusters <- factor(pam_clusters$clustering)
# add k-means clusters
cosDist_mds$kcluster <- as.factor(as.numeric(k_means_clusters$cluster))
# get plot
set.seed(1705)
cosDist_mds %>% filter(logFreq>2) %>% ggplot(aes(x = V1, y = V2,
size = n*5, label = lemma, col = clusters)) +
geom_text_repel(max.overlaps = 25) + theme_bw() + guides(size = 'none') +
scale_color_viridis_d(begin = .1, end = .9)  +
guides(col = "none")
# get plot
set.seed(1705)
cosDist_mds %>% filter(logFreq>2) %>% ggplot(aes(x = V1, y = V2,
size = n*10, label = lemma, col = clusters)) +
geom_text_repel(max.overlaps = 25) + theme_bw() + guides(size = 'none') +
scale_color_viridis_d(begin = .1, end = .9)  +
guides(col = "none")
# get plot
set.seed(1705)
cosDist_mds %>% filter(logFreq>2) %>% ggplot(aes(x = V1, y = V2,
size = n*100, label = lemma, col = clusters)) +
geom_text_repel(max.overlaps = 25) + theme_bw() + guides(size = 'none') +
scale_color_viridis_d(begin = .1, end = .9)  +
guides(col = "none")
# get plot
set.seed(1705)
cosDist_mds %>% filter(logFreq>2) %>% ggplot(aes(x = V1, y = V2,
size = n*5, label = lemma, col = clusters)) +
geom_text_repel(max.overlaps = 25) + theme_bw(base_size = 15) + guides(size = 'none') +
scale_color_viridis_d(begin = .1, end = .9)  +
guides(col = "none")
# get plot
set.seed(1705)
cosDist_mds %>% filter(logFreq>2) %>% ggplot(aes(x = V1, y = V2,
size = n*5, label = lemma, col = clusters)) +
geom_text_repel(max.overlaps = 25) + theme_bw(base_size = 30) + guides(size = 'none') +
scale_color_viridis_d(begin = .1, end = .9)  +
guides(col = "none")
# get plot
set.seed(1705)
cosDist_mds %>% filter(logFreq>2) %>% ggplot(aes(x = V1, y = V2,
size = n*5, label = lemma, col = clusters)) +
geom_text_repel(max.overlaps = 25) + theme_bw() + guides(size = 'none') +
scale_color_viridis_d(begin = .1, end = .9)  +
guides(col = "none") +
scale_size_continuous(range = c(8,20))
# get plot
set.seed(1705)
cosDist_mds %>% filter(logFreq>2) %>% ggplot(aes(x = V1, y = V2,
size = n*5, label = lemma, col = clusters)) +
geom_text_repel(max.overlaps = 25) + theme_bw() + guides(size = 'none') +
scale_color_viridis_d(begin = .1, end = .9)  +
guides(col = "none") +
scale_size_continuous(range = c(5,15))
ggsave("archdistances_pam.png")
# or with k-means clusters instead
set.seed(1705)
cosDist_mds %>% filter(logFreq>2) %>% ggplot(aes(x = V1, y = V2,
size = n*5, label = lemma)) +
stat_ellipse(aes(group = as.factor(kcluster), fill = as.factor(kcluster)),
geom = "polygon", alpha = 0.1, color = NA) +
geom_text_repel(max.overlaps = 25) + theme_bw() + guides(size = 'none') +
scale_color_grey(start = .1, end = .6) +
#scale_color_viridis_d(begin = .3, end = .8)  +
guides(col = "none", fill = "none") +
scale_size_continuous(range = c(5,15))
# or with k-means clusters instead
set.seed(1705)
cosDist_mds %>% filter(logFreq>2) %>% ggplot(aes(x = V1, y = V2,
#size = n,
label = lemma)) +
stat_ellipse(aes(group = as.factor(kcluster), fill = as.factor(kcluster)),
geom = "polygon", alpha = 0.1, color = NA) +
geom_text_repel(max.overlaps = 25) + theme_bw() + guides(size = 'none') +
scale_color_grey(start = .1, end = .6) +
#scale_color_viridis_d(begin = .3, end = .8)  +
guides(col = "none", fill = "none") +
scale_size_continuous(range = c(5,15))
# or with k-means clusters instead
set.seed(1705)
cosDist_mds %>% filter(logFreq>2) %>% ggplot(aes(x = V1, y = V2,
size = n,
label = lemma)) +
stat_ellipse(aes(group = as.factor(kcluster), fill = as.factor(kcluster)),
geom = "polygon", alpha = 0.1, color = NA) +
geom_text_repel(max.overlaps = 25) + theme_bw() + guides(size = 'none') +
scale_color_grey(start = .1, end = .6) +
#scale_color_viridis_d(begin = .3, end = .8)  +
guides(col = "none", fill = "none") +
scale_size_continuous(range = c(5,15))
ggsave("archdistances_k_means.png", width = 7, height = 5, dpi = 600)
cosDist_mds %>% arrange(clusters, desc(n)) %>% filter(n > 5)
# get plot
set.seed(1705)
cosDist_mds %>% filter(logFreq>2) %>% ggplot(aes(x = V1, y = V2,
size = n*5, label = lemma, col = clusters)) +
geom_text_repel(max.overlaps = 25) + theme_bw() + guides(size = 'none') +
scale_color_viridis_d(begin = .1, end = .9)  +
guides(col = "none") +
scale_size_continuous(range = c(5,15))
# or with k-means clusters instead
set.seed(1705)
cosDist_mds %>% filter(logFreq>2) %>% ggplot(aes(x = V1, y = V2,
size = n,
label = lemma)) +
stat_ellipse(aes(group = as.factor(kcluster), fill = as.factor(kcluster)),
geom = "polygon", alpha = 0.1, color = NA) +
geom_text_repel(max.overlaps = 25) + theme_bw() + guides(size = 'none') +
scale_color_grey(start = .1, end = .6) +
#scale_color_viridis_d(begin = .3, end = .8)  +
guides(col = "none", fill = "none") +
scale_size_continuous(range = c(5,15))
ggsave("images/archdistances_k_means.png", width = 14, height = 10, dpi = 600)
ggsave("images/archdistances_k_means.png", width = 14, height = 14, dpi = 600)
# Chunk 1
#| message: false
#| warning: false
#| code-fold: true
library(tidyverse)
library(wordVectors) # https://github.com/bmschmidt/wordVectors/tree/master
library(vroom)
library(pbapply)
library(readxl)
library(ggrepel)
library(cluster)
library(ggiraph)
install.packages("tidyverse")
update.packages("tidyverse")
#| message: false
#| warning: false
#| code-fold: true
library(tidyverse)
library(wordVectors) # https://github.com/bmschmidt/wordVectors/tree/master
library(vroom)
library(pbapply)
library(readxl)
library(ggrepel)
library(cluster)
library(ggiraph)
version("ggplot2")
package_version(ggplot2)
package_version("ggplot2")
?`ggplot2-package`
update.packages("ggplot2")
